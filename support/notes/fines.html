<h1 id="how-to-trouble-shoot-fines">How to trouble-shoot fines:</h1>
<h2 id="are-fines-enabled">Are fines enabled?</h2>
<dl>
<dt>Git sites</dt>
<dd><p><code>crontab -ukoha -l | grep fines</code> should give something like this:</p>
<p>15 6 * * * $KOHA_CRON_PATH/fines.pl --out /tmp/fines</p>
</dd>
<dt>Package sites</dt>
<dd><p><code>grep fines /etc/cron.daily/koha*</code> should show a call to fines.pl.</p>
</dd>
</dl>
<h2 id="run-fines.pl-by-hand">Run fines.pl by hand</h2>
<p>From fines.pl:</p>
<pre><code>This script calculates and charges overdue fines
to patron accounts.  The Koha system preference &#39;finesMode&#39; controls
whether the fines are calculated and charged to the patron accounts (&quot;Calculate and charge&quot;);
calculated and emailed to the admin but not applied (&quot;Calculate (but only for mailing to the admin)&quot;); or not calculated (&quot;Don&#39;t calculate&quot;).

This script has the following parameters :
    -h --help: this message
    -l --log: log the output to a file (optional if the -o parameter is given)
    -o --out:  ouput directory for logs (defaults to env or /tmp if !exist)
    -v --verbose</code></pre>
<p>For git sites, run</p>
<pre><code>sudo su - koha
$HOME/kohaclone/misc/cronjobs/fines.pl --verbose --log</code></pre>
<p>Output will be written to a file whose naming convention is <code>koha_YYYY-MM-DD.log</code>. By default, the file will be in <code>tmp</code>. If the command above were run on July 31, 2014, the log file would be <code>/tmp/koha_2014-07-31.log</code></p>
<h2 id="known-issues">Known issues</h2>
<ul>
<li><code>fines.pl --out DIRECTORY_NAME</code> will fail if <code>DIRECTORY_NAME</code> does not exist.
<ul>
<li>This is especially bad for directories under <code>/tmp</code>, because the <code>/tmp</code> directory will be deleted and re-created on server reboot.</li>
</ul></li>
<li><code>fines.pl</code> will crash if the branch cannot be determined for a given item. Depending on the values of the system preferences <code>HomeOrHoldingBranch</code> and 'CircControl', the borrower's home branch, the item's branch, the item's holdingbranch or some combination of these three may be usedt to determine which branch is used for fines.</li>
<li><code>Not a unique accountlines record for item X borrower Y at /home/koha/kohaclone/C4/Overdues.pm line 526.</code> -- I'm not sure what this is... it's not fatal, but I don't know how it affects the given item/borrower.</li>
<li><code>fines.pl</code> has been known to hang for some yet undetermined reason.</li>
</ul>
