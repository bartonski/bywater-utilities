#!/usr/bin/perl

use warnings;
use strict;

# A line from bwsbot will look like this:
# 11:51 <@bwsbot> Bug http://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=15331 enhancement, P5 - low, ---, gmcharlt, NEW , Sort order breaks at offset=1000 (both OPAC and Intranet)
# So:

# 1: remove text up through '<@bwsbot> '
# 2: Split text on ', ':
# 
#   0: Bug http://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=15331 enhancement
#      --  my ($bug_number, $type) =~ m|Bug http://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=(\d+) (.*)|
#   1: P5 - low
#      -- my ( $priority, $severity ) =~ m|(.*) - (.*)|;
#   2: ---
#      -- ???
#   3: gmcharlt
#      -- $asignee
#   4: NEW 
#      -- $status
#   5: Sort order breaks at offset=1000 (both OPAC and Intranet)
#      -- Everything past field 5 should be joined as '$bug_title'
# 3: print results.

my $line = "@ARGV";
chomp $line;
$line =~ s/.*<.{0,1}bwsbot> //;
$line =~ s/\s{2,}/ /;
my @F = split( ', ', $line );
my $x;

$x = shift @F;
my ($bug_number, $type) = ( $x ) =~ m|Bug http://bugs.koha-community.org/bugzilla3/show_bug.cgi\?id=(\d+) (.*)|;
 
$x = shift @F;
my ( $priority, $severity ) =  ( $x ) =~ m|(.*) - (.*)| ;

$x = shift @F; # not sure what this is for.

$x = shift @F;
my ( $asignee )             =  ( $x );

$x = shift @F;
my ( $status )              =  ( $x );

my ( $bug_title )           =  join( q[, ], @F ) ;

print "Bug ${bug_number}: ${bug_title}\n";
print "      URL: http://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=${bug_number}\n";
print " Priority: ${priority}\n";
print "  Urgency: ${type}\n";
print "   Status: ${status}\n";
